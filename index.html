<!DOCTYPE html>
<html>
	<meta charset="utf-8">
	<head>
		<title>finally</title>
		<link rel="icon" href="drum.png">
		<style>

body {
	background-color: black;
}

.song {
	background-color: grey;
	color: white;
	padding: 20px;	
	margin: 10px;
	display: cell;
}

.song-origin {
}

.song-name {
	float: right;
	line-height: 0px;
	margin-top: -10px;
}
		</style>
	</head>
	<body>	
		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

		<script>

class FinallySong {
    constructor(origin, name, identifier) {
        this.origin = origin;
        this.name = name;
        this.identifier = identifier;
    }

    generateDiv() {
        return "<div class='song'><div class='song-origin'>" + this.origin + "</div><div class='song-name'>" + this.name + "</div></div>";
    }
}

function renderFinallyData(json) {
    var songs = [];
    for (var i = 0; i < json.length; i++) {
        var songJSON = json[i];
        var songParsedJSON = $.parseJSON(songJSON);

        var name = songParsedJSON.name;
        var identifier = songParsedJSON.identifier;
        var origin = songParsedJSON.origin;

        var song = new FinallySong(origin, name, identifier);
        songs.push(song);
    }

    var sortedSongs = songs.sort(function(a, b) {
        return b.name-a.name;
    });;

    for (var i = 0; i < sortedSongs.length; i++) {
        var div = sortedSongs[i].generateDiv();
        $("body").append(div);
    }
}

function runFinallyPython(completionBlock) {
    var phraseAPIURL = "/run"
    $.get(phraseAPIURL, function(data) {
        console.log(data)
        completionBlock(data);
    }).fail(function(jqXHR, textStatus) {
        console.log(textStatus);
        completionBlock(null);
    });
}

function loadFinally() {
    runFinallyPython(function(result) {
        if (result == null) {
            console.log("âš  result == null");
            return;
        }

        renderFinallyData(result);
    });
}

window.onload = function() {
    loadFinally();
};

		</script>
	</body>
</html>
